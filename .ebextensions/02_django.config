container_commands:
  00_print_cwd:
    command: "mkdir www/static"
    ignoreErrors: true
    leader_only: true
  01_install_node_modules:
    command: |
      source ../venv/bin/activate
      curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.34.0/install.sh | bash
      . ~/.nvm/nvm.sh
      nvm install node
      npm install static/ --prefix static/
    ignoreErrors: true
  02_collectstatic:
    command: "source ../venv/bin/activate && python manage.py collectstatic --noinput"

option_settings:
  aws:elasticbeanstalk:application:environment:
    DJANGO_SETTINGS_MODULE: "plan_ilan.settings"
    "PYTHONPATH": "/var/app/current:$PYTHONPATH"
  aws:elasticbeanstalk:container:python:
    WSGIPath: plan_ilan.wsgi:application
    NumProcesses: 3
    NumThreads: 20
